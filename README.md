# CFDEM颗粒填充密度仿真项目

基于CFDEM（CFD-DEM耦合）框架的颗粒水流相互作用仿真，研究球形颗粒在筒仓中的沉积和填充行为。

## 项目概述

本项目实现颗粒与流体的双向耦合仿真：

- **DEM阶段**：100个球形颗粒在筒仓中的初始插入和稳定
- **CFD-DEM耦合阶段**：颗粒与流体的相互作用，包括流体阻力和颗粒对流场的影响
- **后处理**：生成VTK格式文件用于ParaView可视化分析

## 仿真参数

### 几何设置

- **计算域**：圆柱形筒仓，半径0.14m，高度1.14m
- **颗粒**：100个球形颗粒，半径0.01m，密度2500 kg/m³
- **插入区域**：筒仓上部圆柱区域（1.0-1.14m高度）

### DEM参数

- **接触模型**：Hertz切向历史模型
- **材料属性**：
  - 杨氏模量：5×10⁶ Pa
  - 泊松比：0.45
  - 恢复系数：0.3
  - 摩擦系数：0.5
- **时间步长**：1×10⁻⁵ s

### CFD参数

- **求解器**：cfdemSolverMultiphase
- **仿真时间**：1.0 s
- **时间步长**：1×10⁻⁴ s
- **写入间隔**：0.01 s
- **最大Courant数**：0.1
- **CFD-DEM耦合频率**：每100步

## 仿真流程

### 1. 完整自动运行

```bash
./Allrun.sh
```

### 2. 分步运行

#### 步骤1：预处理

```bash
./prerun.sh
```

- 复制初始条件文件(0.org → 0)
- 运行setFields设置流场

#### 步骤2：DEM初始化

```bash
./parDEMrun.sh
```

**阶段1：初始化阶段 (in.liggghts_init)**

这是纯DEM计算阶段，主要完成以下任务：

##### 颗粒插入
- 在筒仓上部圆柱区域（高度1.0-1.14m）插入100个球形颗粒
- 颗粒半径：0.01m，密度：2500 kg/m³
- 初始速度：0 m/s（静止释放）

##### 动态沉降控制
- **速度监控**：实时计算颗粒的平均速度和最大速度
- **收敛判断**：基于双重速度阈值判断颗粒是否达到平衡状态
  - 平均速度阈值：0.01 m/s
  - 最大速度阈值：0.02 m/s
- **安全保护**：最大沉降时间10秒，防止无限循环
- **检查频率**：每500个时间步检查一次收敛状态

##### 输出控制
- **热力学输出**：每1000步输出一次颗粒状态
- **数据转储**：每500步保存颗粒轨迹数据
- **重启文件**：沉降完成后生成 `liggghts.restart` 供耦合使用

##### 关键特性
- 使用Hertz接触模型模拟颗粒间相互作用
- 考虑重力作用（9.8 m/s²，Z方向）
- STL几何边界条件（筒仓壁和顶盖）
- 自适应时间步长控制

#### 步骤3：CFD-DEM耦合仿真

```bash
./parCFDDEMrun.sh
```

- 运行 `in.liggghts_run`脚本
- 读取DEM初始化的restart文件
- 启动CFD-DEM双向耦合计算
- 颗粒受到流体阻力作用
- 颗粒影响局部流场

#### 步骤4：后处理

```bash
./postrun.sh
```

- 转换LIGGGHTS输出为VTK格式
- 重构并行CFD结果
- 转换OpenFOAM结果为VTK格式

#### 清理结果

```bash
./Allclean.sh
```

## 关键脚本说明

### DEM脚本

- **`in.liggghts_init`**：DEM初始化，颗粒插入和稳定
- **`in.liggghts_run`**：CFD-DEM耦合运行，包含流体力计算

### CFD配置

- **`blockMeshDict`**：网格生成配置
- **`controlDict`**：仿真控制参数
- **`setFieldsDict`**：初始流场设置

### CFDEM耦合设置

- **耦合频率**：`couple_every 100`
- **力模型**：`couple/cfd/force/implicit`
- **处理器配置**：`processors 2 2 1`

## 输出结果

### DEM结果

- **位置**：`DEM/post/`
- **格式**：
  - `dump*.liggghts_run`：颗粒轨迹数据
  - `*.vtk`：ParaView可视化文件
  - `restart/liggghts.restart`：重启文件

### CFD结果

- **位置**：`CFD/VTK/`
- **内容**：流场速度、压力、相分数等
- **格式**：VTK文件，可直接用ParaView打开

### 监控数据

- **质心位置**：`c_centerOfMass[3]`
- **总阻力**：`c_dragtotal[1] c_dragtotal[2] c_dragtotal[3]`
- **颗粒动能**：`ke` + 转动动能 `c_rke`

## 可视化分析

使用ParaView打开VTK文件：

1. **颗粒动画**：显示颗粒运动轨迹和受力情况
2. **流场分析**：查看速度矢量场和压力分布
3. **相互作用**：观察颗粒对流场的扰动效果

## 依赖软件

- **OpenFOAM**：CFD求解器
- **LIGGGHTS**：DEM求解器
- **CFDEM**：CFD-DEM耦合框架
- **ParaView**：后处理可视化（推荐）

## 系统要求

- 并行运行：4核心（可在parCFDDEMrun.sh中调整）
- 内存：建议8GB以上
- 存储：约2-5GB输出文件
